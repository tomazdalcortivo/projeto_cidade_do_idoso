<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Desenhe o Padrão</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .game-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 40px;
            margin-top: 20px;
        }
        .pattern-area, .game-grid {
            display: grid;
            grid-template-columns: repeat(10, 30px);
            grid-template-rows: repeat(10, 30px);
            border: 2px solid #333;
        }
        .cell {
            width: 30px;
            height: 30px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }
        .current-cell {
            border: 3px solid #6C63FF;
        }
        .color-palette {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        .color-box {
            width: 50px;
            height: 50px;
            border: 2px solid #ccc;
            cursor: pointer;
        }
        #current-color-box {
            width: 50px;
            height: 50px;
            border: 4px solid #4CAF50;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <h1>Desenhe o Padrão</h1>
    <div class="container">
        <p style="font-size:24px;">Use as setas para se mover, Shift para mudar a cor e Espaço ou o clique para pintar!</p>

        <div class="game-container">
            <div>
                <h3>Padrão a Copiar</h3>
                <div id="target-pattern" class="pattern-area"></div>
            </div>
            <div>
                <h3>Seu Desenho</h3>
                <div id="game-grid" class="game-grid"></div>
            </div>
        </div>
        
        <p id="result" style="font-size:28px; margin-top: 20px;"></p>

        <h3>Cor do Fio Atual:</h3>
        <div id="current-color-box"></div>
        
        <br>
        <button onclick="newGame()">Reiniciar Jogo</button>
        <button onclick="location.href='menu.html'">Voltar</button>
    </div>

    <script>
        const colors = ['#8A2BE2', '#FFD700', '#FF0000', '#32CD32', '#0000FF', '#964b00'];
        const blankColor = '#f0f0f0';
        const gridSize = 10;
        let playerPos = { x: 0, y: 0 };
        let currentColorIndex = 0;
        let gameGrid = [];
        let targetPattern = [];

        const gameGridEl = document.getElementById('game-grid');
        const targetPatternEl = document.getElementById('target-pattern');
        const resultEl = document.getElementById('result');
        const currentColorBoxEl = document.getElementById('current-color-box');

        const patterns = {
            'heart': [
                [0, 0, 1, 1, 0, 0, 1, 1, 0, 0],
                [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
                [0, 0, 1, 1, 1, 1, 1, 1, 0, 0],
                [0, 0, 0, 1, 1, 1, 1, 0, 0, 0],
                [0, 0, 0, 0, 1, 1, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            ],
            'square': [
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 1, 1, 1, 1, 0, 0, 0],
                [0, 0, 0, 1, 0, 0, 1, 0, 0, 0],
                [0, 0, 0, 1, 0, 0, 1, 0, 0, 0],
                [0, 0, 0, 1, 0, 0, 1, 0, 0, 0],
                [0, 0, 0, 1, 0, 0, 1, 0, 0, 0],
                [0, 0, 0, 1, 0, 0, 1, 0, 0, 0],
                [0, 0, 0, 1, 1, 1, 1, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            ]
        };

        function setupGame() {
            gameGridEl.innerHTML = '';
            targetPatternEl.innerHTML = '';
            gameGrid = [];
            
            const patternKeys = Object.keys(patterns);
            const randomPatternKey = patternKeys[Math.floor(Math.random() * patternKeys.length)];
            targetPattern = patterns[randomPatternKey];

            for (let i = 0; i < gridSize; i++) {
                gameGrid[i] = [];
                for (let j = 0; j < gridSize; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.x = j;
                    cell.dataset.y = i;
                    cell.addEventListener('click', () => {
                        knitCell(cell, colors[currentColorIndex]);
                    });
                    gameGridEl.appendChild(cell);
                    gameGrid[i][j] = blankColor;
                }
            }

            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    if (targetPattern[i][j] === 1) {
                        cell.style.backgroundColor = '#FF0000';
                    }
                    targetPatternEl.appendChild(cell);
                }
            }

            playerPos = { x: 0, y: 0 };
            updateCursor();
            updateCurrentColorBox();
            resultEl.textContent = '';
        }

        function updateCursor() {
            const cells = gameGridEl.querySelectorAll('.cell');
            cells.forEach(cell => cell.classList.remove('current-cell'));
            const currentCell = gameGridEl.querySelector(`[data-x='${playerPos.x}'][data-y='${playerPos.y}']`);
            if (currentCell) {
                currentCell.classList.add('current-cell');
            }
        }

        function updateCurrentColorBox() {
            currentColorBoxEl.style.backgroundColor = colors[currentColorIndex];
        }

        function knitCell(cell, color) {
            cell.style.backgroundColor = color;
            const x = parseInt(cell.dataset.x);
            const y = parseInt(cell.dataset.y);
            gameGrid[y][x] = color;
            checkWin();
        }

        function checkWin() {
            let win = true;
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    const expectedColor = targetPattern[i][j] === 1 ? '#FF0000' : blankColor;
                    if (gameGrid[i][j].toLowerCase() !== expectedColor.toLowerCase()) {
                        win = false;
                        break;
                    }
                }
                if (!win) break;
            }
            if (win) {
                resultEl.textContent = "Parabéns, você completou o padrão!";
                resultEl.className = "success";
            }
        }

        document.addEventListener('keydown', (e) => {
            const cells = gameGridEl.querySelectorAll('.cell');
            const currentCell = cells[playerPos.y * gridSize + playerPos.x];

            switch (e.key) {
                case 'ArrowUp':
                    playerPos.y = Math.max(0, playerPos.y - 1);
                    break;
                case 'ArrowDown':
                    playerPos.y = Math.min(gridSize - 1, playerPos.y + 1);
                    break;
                case 'ArrowLeft':
                    playerPos.x = Math.max(0, playerPos.x - 1);
                    break;
                case 'ArrowRight':
                    playerPos.x = Math.min(gridSize - 1, playerPos.x + 1);
                    break;
                case 'Shift':
                    currentColorIndex = (currentColorIndex + 1) % colors.length;
                    updateCurrentColorBox();
                    break;
                case ' ': // Spacebar
                    e.preventDefault(); // Prevent page from scrolling
                    knitCell(currentCell, colors[currentColorIndex]);
                    break;
                case 'Backspace':
                    knitCell(currentCell, blankColor);
                    break;
            }
            updateCursor();
        });

        function newGame() {
            setupGame();
        }

        window.onload = setupGame;
    </script>
</body>

</html>